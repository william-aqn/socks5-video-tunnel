# Video-Go Traffic Tunneller

Экспериментальный проект для туннелирования SOCKS5 трафика через видеопоток (виртуальная камера + захват экрана).

## Принцип работы

Данные кодируются в несжатые RGBA-кадры. Система работает в двунаправленном режиме:
1.  **Исходящий поток**: Данные упаковываются в кадры и отправляются в виртуальную веб-камеру.
2.  **Входящий поток**: Система захватывает область экрана (где отображается видео от удаленного узла) и декодирует данные.

Это позволяет передавать трафик через любое приложение для видеосвязи (Discord, Skype, Zoom и др.).

## Установка

1.  Установите [Go](https://go.dev/dl/).
2.  Соберите проект:
    ```bash
    go build -o video-go.exe .
    ```
3.  Установите драйвер виртуальной камеры **UnityCapture** (требуется для Windows):
    *   Скачайте `UnityCapture.dll` ([релизы UnityCapture](https://github.com/schellingb/UnityCapture/releases)).
    *   Зарегистрируйте её в системе от имени администратора:
        ```cmd
        regsvr32 UnityCapture.dll
        ```

## Использование

### 1. Подготовка видеосвязи
*   Запустите любое приложение для видеозвонков на двух узлах.
*   Выберите в качестве камеры устройство **"UnityCapture"**.

### 2. Запуск сервера (выходной узел)
Сервер будет считывать запросы клиента с экрана и отправлять ответы через виртуальную камеру.
```bash
./video-go.exe -mode=server
```
При первом запуске (или если координаты не сохранены) откроется полупрозрачное окно. Перетащите его так, чтобы оно накрывало область, где отображается видео от клиента, и нажмите **ENTER**. Координаты будут сохранены в `config_server.json` и использованы при следующем запуске.

*   `-capture-x`, `-capture-y`: Можно указать координаты вручную.
*   `-margin`: Отступ от краев (в пикселях) при генерации и захвате видео. Помогает, если края видео обрезаются платформой связи. По умолчанию: 10.
*   `-ui`: Принудительно вызвать окно выбора при старте.

### Контрольные точки (Markers)
В каждом генерируемом кадре в углах присутствуют контрольные точки (2x2 пикселя):
*   **Левый верхний**: Красный
*   **Правый верхний**: Зеленый
*   **Левый нижний**: Синий
*   **Правый нижний**: Белый
Используйте эти точки для максимально точного совмещения области захвата с видеопотоком.

### Горячие клавиши (только Windows)
*   **Ctrl+Alt+S** (для сервера): Вызвать окно выбора области захвата во время работы.
*   **Ctrl+Alt+C** (для клиента): Вызвать окно выбора области захвата во время работы.
*   После выбора новые координаты будут применены "на лету" и сохранены в соответствующий конфиг.

### 3. Запуск клиента (входной узел)
Клиент создает SOCKS5 прокси на локальном порту.
```bash
./video-go.exe -mode=client -local=:1080
```
Аналогично серверу, выберите область экрана, где отображается видео от сервера, и нажмите **ENTER**. Координаты сохранятся в `config_client.json`.

### 4. Настройка прокси
Настройте браузер или используйте curl для работы через SOCKS5:
```bash
curl --socks5 localhost:1080 http://google.com
```

## Технические подробности

*   **Разрешение**: 640x480 (RGBA).
*   **Кодек**: Данные записываются в RGB каналы пикселей.
*   **Ограничение**: Кодек чувствителен к сжатию. Видео должно отображаться в масштабе 1:1.

## Тестирование

```bash
go test -v .
```
